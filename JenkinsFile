node {
  docker.image('node:16-alpine').withRun('-u root:node') {
    
    stage('Build') {
      sh 'npm install'
      sh 'npm run export'
    }

    stage('Deploy') {
      withAWS(credentials: 'aws-credentials', region: 'us-east-2') {
        s3Upload(pathStyleAccessEnabled: true, file: 'out', bucket: 'next-jenkins')
      }
    }

    post {
      always {
        deleteDir()
      }
    }
  }
}
